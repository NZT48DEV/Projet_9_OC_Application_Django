{% extends "base.html" %}
{% load custom_tags %}
{% block content %}
<div class="container mt-5">
    <h2 class="text-center mb-4">Vos posts</h2>

    {% if posts %}
        {% for post in posts %}
            {% if post|classname == "Review" %}
                {# On affiche les critiques seules (liées à un ticket qui n’appartient pas à l’utilisateur) #}
                {% include "reviews/partials/_review_card.html" with review=post %}

            {% elif post|classname == "Ticket" %}
                <div class="card mb-4 p-3">
                    <!-- Ticket -->
                    {% include "tickets/partials/_ticket_card.html" with ticket=post %}

                    <!-- Critiques associées au ticket -->
                    {% if post.review_set.all %}
                        {% for review in post.review_set.all %}
                            <div class="card bg-light p-3 mt-3">
                                {% include "reviews/partials/_review_card.html" with review=review hide_ticket=True %}
                            </div>
                        {% endfor %}
                    {% else %}
                        <div class="card bg-light p-3 mt-3">
                            <p class="text-muted">Aucune critique pour le moment.</p>
                        </div>
                    {% endif %}
                </div>
            {% endif %}
        {% endfor %}
    {% else %}
        <p class="text-center mb-4">Vous n’avez encore rien posté.</p>
    {% endif %}
</div>
{% endblock %}
