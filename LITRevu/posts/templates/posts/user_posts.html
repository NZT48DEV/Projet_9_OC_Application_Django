{% extends "base.html" %}
{% load custom_tags %}
{% block content %}
<div class="container mt-5">

    <!-- Titre -->
    <div class="text-center mb-5">
        <h2 class="fw-bold">
            üìù Vos posts
        </h2>
        <p class="text-muted">Retrouvez ici vos tickets et critiques publi√©s.</p>
    </div>

    {% if posts %}
        {% for post in posts %}
            {% if post|classname == "Review" %}
                <!-- Review seule -->
                <div class="card mb-4 p-3 shadow-sm">
                    {% include "reviews/partials/_review_card.html" with review=post %}
                </div>

            {% elif post|classname == "Ticket" %}
                <div class="card mb-4 p-3 shadow-sm">
                    <!-- Ticket -->
                    {% include "tickets/partials/_ticket_card.html" with ticket=post %}

                    <!-- Critiques associ√©es -->
                    {% if post.review_set.all %}
                        {% for review in post.review_set.all %}
                            <div class="card bg-light p-3 mt-3">
                                {% include "reviews/partials/_review_card.html" with review=review hide_ticket=True %}
                            </div>
                        {% endfor %}
                    {% else %}
                        <div class="card bg-light p-3 mt-3">
                            <p class="text-muted mb-0">Aucune critique pour le moment.</p>
                        </div>
                    {% endif %}
                </div>
            {% endif %}
        {% endfor %}
    {% else %}
        <!-- Message vide -->
        <div class="card text-center shadow-sm border-0 bg-light p-5 mt-4">
            <div class="mb-3">
                <i class="bi bi-inbox fs-1 text-secondary"></i>
            </div>
            <h5 class="fw-bold">ü§∑ Vous n'avez encore rien post√©.</h5>
            <p class="text-muted">Commencez d√®s maintenant en cr√©ant un ticket ou une critique.</p>
            <div class="mt-3">
                <a href="{% url 'create_ticket' %}" class="btn btn-outline-primary me-2">üìö Demander une critique</a>
                <a href="{% url 'create_review_with_ticket' %}" class="btn btn-outline-success">‚úçÔ∏è Cr√©er une critique</a>
            </div>
        </div>
    {% endif %}
</div>
{% endblock %}
