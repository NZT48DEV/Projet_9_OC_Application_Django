{% extends "base.html" %}
{% load custom_tags %}
{% block content %}
<div class="container" role="main">

    <!-- üîπ En-t√™te de la page -->
    <header class="text-center mb-5">
        <h1 class="fw-bold" id="page-title">üìù Vos posts</h1>
        <p class="text-muted">Retrouvez ici vos tickets et critiques publi√©s.</p>
    </header>

    {% if posts %}
        <!-- üîπ Liste des posts -->
        <section aria-labelledby="page-title">
            {% for post in posts %}
                {% if post|classname == "Review" %}
                    <!-- üî∏ Bloc Review seule -->
                    <article class="card mb-4 p-3 shadow-sm" aria-label="Critique publi√©e">
                        {% include "reviews/partials/_review_card.html" with review=post %}
                    </article>

                {% elif post|classname == "Ticket" %}
                    <!-- üî∏ Bloc Ticket -->
                    <article class="card mb-4 p-3 shadow-sm" aria-label="Ticket publi√©">
                        {% include "tickets/partials/_ticket_card.html" with ticket=post %}

                        <!-- üîπ Critiques associ√©es -->
                        {% if post.review_set.all %}
                            <section class="mt-3" aria-label="Critiques associ√©es √† ce ticket">
                                {% for review in post.review_set.all %}
                                    <div class="card bg-light p-3 mt-3">
                                        {% include "reviews/partials/_review_card.html" with review=review hide_ticket=True %}
                                    </div>
                                {% endfor %}
                            </section>
                        {% else %}
                            <!-- üî∏ Message si aucune critique -->
                            <div class="card bg-light p-3 mt-3 border-secondary shadow-sm">
                                <p class="text-muted mb-0">Aucune critique pour le moment.</p>
                            </div>
                        {% endif %}

                        <!-- üîπ Lien pour ajouter une critique si aucune n‚Äôexiste -->
                        {% if not post.review_set.exists %}
                            <div class="text-end">
                                <a href="{% url 'create_review_response' post.id %}"
                                   class="btn btn-success mt-3"
                                   aria-label="Ajouter une critique au ticket {{ post.title }}">
                                    ‚ûï Ajouter une critique
                                </a>
                            </div>
                        {% endif %}
                    </article>
                {% endif %}
            {% endfor %}
        </section>
    {% else %}

        <!-- üîπ Message si aucun post -->
        <section class="card text-center shadow-sm border-0 bg-light p-5 mt-4" aria-label="Aucun post disponible">
            <div class="mb-3">
                <i class="bi bi-inbox fs-1 text-secondary" aria-hidden="true"></i>
            </div>
            <h2 class="fw-bold">ü§∑ Vous n'avez encore rien post√©.</h2>
            <p class="text-muted">Commencez d√®s maintenant en cr√©ant un ticket ou une critique.</p>
            <div class="mt-3">
                <a href="{% url 'create_ticket' %}"
                   class="btn btn-outline-primary me-2"
                   aria-label="Cr√©er un ticket pour demander une critique">
                    üìö Demander une critique
                </a>
                <a href="{% url 'create_review_with_ticket' %}"
                   class="btn btn-outline-success"
                   aria-label="Cr√©er une critique avec ticket">
                    ‚úçÔ∏è Cr√©er une critique
                </a>
            </div>
        </section>
    {% endif %}
</div>
{% endblock %}
