{% extends "base.html" %}
{% block content %}
<div class="container mt-5">

    <!-- Titre principal -->
    <div class="text-center mb-5">
        <h2 class="fw-bold">ðŸ‘¥ GÃ©rer vos abonnements</h2>
        <p class="text-muted">Suivez de nouveaux utilisateurs ou gÃ©rez vos abonnements et blocages.</p>
    </div>

    <!-- ðŸ”¹ Barre de recherche pour s'abonner -->
    <div class="card shadow-sm mb-5">
        <div class="card-body">
            <h4 class="card-title mb-3">S'abonner Ã  un utilisateur</h4>
            <form method="post" class="d-flex position-relative">
                {% csrf_token %}
                <input type="text" id="search-user-follow" name="username" 
                       class="form-control" placeholder="Nom d'utilisateur Ã  suivre" autocomplete="off">
                <button type="submit" class="btn btn-primary ms-2">
                    <i class="bi bi-person-plus"></i> S'abonner
                </button>
                <ul id="suggestions-follow" class="list-group position-absolute w-100" 
                    style="top: 100%; z-index: 1000;"></ul>
            </form>
        </div>
    </div>

    <!-- ðŸ”¹ Liste des abonnements -->
    <div class="card shadow-sm mb-5">
        <div class="card-body">
            <h4 class="card-title mb-3">ðŸ“Œ Abonnements</h4>
            <ul class="list-group">
                {% for follow in following %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        {{ follow.followed_user.username }}
                        <a href="{% url 'unfollow' follow.followed_user.id %}" class="btn btn-danger btn-sm">
                            <i class="bi bi-person-dash"></i> DÃ©sabonner
                        </a>
                    </li>
                {% empty %}
                    <li class="list-group-item text-muted text-center">Vous ne suivez personne pour lâ€™instant.</li>
                {% endfor %}
            </ul>
        </div>
    </div>

    <!-- ðŸ”¹ Liste des abonnÃ©s -->
    <div class="card shadow-sm mb-5">
        <div class="card-body">
            <h4 class="card-title mb-3">ðŸ‘€ AbonnÃ©s</h4>
            <ul class="list-group">
                {% for follower in followers %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        {{ follower.user.username }}
                        <a href="{% url 'block_user' follower.user.id %}" class="btn btn-warning btn-sm">
                            <i class="bi bi-person-x"></i> Bloquer
                        </a>
                    </li>
                {% empty %}
                    <li class="list-group-item text-muted text-center">Vous nâ€™avez aucun abonnÃ© pour le moment.</li>
                {% endfor %}
            </ul>
        </div>
    </div>

    <!-- ðŸ”¹ Bloquer un utilisateur -->
    <div class="card shadow-sm mb-5">
        <div class="card-body">
            <h4 class="card-title mb-3">ðŸš« Bloquer un utilisateur</h4>
            <form method="post" action="{% url 'block_user_search' %}" class="d-flex position-relative">
                {% csrf_token %}
                <input type="text" id="search-user-block" name="username" 
                       class="form-control" placeholder="Nom d'utilisateur Ã  bloquer" autocomplete="off">
                <button type="submit" class="btn btn-warning ms-2">
                    <i class="bi bi-shield-exclamation"></i> Bloquer
                </button>
                <ul id="suggestions-block" class="list-group position-absolute w-100" 
                    style="top: 100%; z-index: 1000;"></ul>
            </form>
        </div>
    </div>

    <!-- ðŸ”¹ Liste des utilisateurs bloquÃ©s -->
    <div class="card shadow-sm">
        <div class="card-body">
            <h4 class="card-title mb-3">â›” Utilisateurs bloquÃ©s</h4>
            <ul class="list-group">
                {% for blocked in blocked_list %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        {{ blocked.blocked_user.username }}
                        <a href="{% url 'unblock_user' blocked.blocked_user.id %}" class="btn btn-success btn-sm">
                            <i class="bi bi-unlock"></i> DÃ©bloquer
                        </a>
                    </li>
                {% empty %}
                    <li class="list-group-item text-muted text-center">Aucun utilisateur bloquÃ©.</li>
                {% endfor %}
            </ul>
        </div>
    </div>

</div>
{% endblock %}
