{% extends "base.html" %}
{% block title %}GÃ©rer vos abonnements - LITRevu{% endblock title %}

{% block content %}
<div class="container" role="main">

    <!-- Titre principal -->
    <header class="text-center mb-5">
        <h1 class="fw-bold">ðŸ‘¥ GÃ©rer vos abonnements</h1>
        <p class="text-muted">Suivez de nouveaux utilisateurs ou gÃ©rez vos abonnements et blocages.</p>
    </header>

    <!-- ðŸ”¹ Barre de recherche pour s'abonner -->
    <section class="card shadow-sm mb-5" aria-labelledby="subscribe-title">
        <div class="card-body">
            <h2 id="subscribe-title" class="card-title mb-3 fs-4">Sâ€™abonner Ã  un utilisateur</h2>
            <form method="post" class="d-flex position-relative" role="search" aria-label="Formulaire dâ€™abonnement">
                {% csrf_token %}
                <label for="search-user-follow" class="visually-hidden">Nom dâ€™utilisateur Ã  suivre</label>
                <input type="text" id="search-user-follow" name="username"
                       class="form-control" placeholder="Nom dâ€™utilisateur Ã  suivre" autocomplete="off">
                <button type="submit" class="btn btn-primary ms-2">
                    <i class="bi bi-person-plus" aria-hidden="true"></i> 
                    <span class="visually-hidden">Sâ€™abonner</span>
                    <span aria-hidden="true">Sâ€™abonner</span>
                </button>
                <ul id="suggestions-follow" class="list-group position-absolute w-100"
                    style="top: 100%; z-index: 1000;" role="listbox" aria-label="Suggestions dâ€™utilisateurs"></ul>
            </form>
        </div>
    </section>

    <!-- ðŸ”¹ Liste des abonnements -->
    <section class="card shadow-sm mb-5" aria-labelledby="following-title">
        <div class="card-body">
            <h2 id="following-title" class="card-title mb-3 fs-4">ðŸ“Œ Abonnements</h2>
            <ul class="list-group" role="list" aria-label="Liste des abonnements">
                {% for follow in following %}
                    <li class="list-group-item d-flex justify-content-between align-items-center" role="listitem">
                        <span>{{ follow.followed_user.username }}</span>
                        <a href="{% url 'unfollow' follow.followed_user.id %}" 
                           class="btn btn-danger btn-sm" aria-label="Se dÃ©sabonner de {{ follow.followed_user.username }}">
                            <i class="bi bi-person-dash" aria-hidden="true"></i> DÃ©sabonner
                        </a>
                    </li>
                {% empty %}
                    <li class="list-group-item text-muted text-center">Vous ne suivez personne pour lâ€™instant.</li>
                {% endfor %}
            </ul>
        </div>
    </section>

    <!-- ðŸ”¹ Liste des abonnÃ©s -->
    <section class="card shadow-sm mb-5" aria-labelledby="followers-title">
        <div class="card-body">
            <h2 id="followers-title" class="card-title mb-3 fs-4">ðŸ‘€ AbonnÃ©s</h2>
            <ul class="list-group" role="list" aria-label="Liste de vos abonnÃ©s">
                {% for follower in followers %}
                    <li class="list-group-item d-flex justify-content-between align-items-center" role="listitem">
                        <span>{{ follower.user.username }}</span>
                        <a href="{% url 'block_user' follower.user.id %}" 
                           class="btn btn-warning btn-sm" aria-label="Bloquer {{ follower.user.username }}">
                            <i class="bi bi-person-x" aria-hidden="true"></i> Bloquer
                        </a>
                    </li>
                {% empty %}
                    <li class="list-group-item text-muted text-center">Vous nâ€™avez aucun abonnÃ© pour le moment.</li>
                {% endfor %}
            </ul>
        </div>
    </section>

    <!-- ðŸ”¹ Bloquer un utilisateur -->
    <section class="card shadow-sm mb-5" aria-labelledby="block-title">
        <div class="card-body">
            <h2 id="block-title" class="card-title mb-3 fs-4">ðŸš« Bloquer un utilisateur</h2>
            <form method="post" action="{% url 'block_user_search' %}" class="d-flex position-relative" 
                  aria-label="Formulaire de blocage dâ€™utilisateur">
                {% csrf_token %}
                <label for="search-user-block" class="visually-hidden">Nom dâ€™utilisateur Ã  bloquer</label>
                <input type="text" id="search-user-block" name="username"
                       class="form-control" placeholder="Nom dâ€™utilisateur Ã  bloquer" autocomplete="off">
                <button type="submit" class="btn btn-warning ms-2">
                    <i class="bi bi-shield-exclamation" aria-hidden="true"></i> 
                    <span class="visually-hidden">Bloquer</span>
                    <span aria-hidden="true">Bloquer</span>
                </button>
                <ul id="suggestions-block" class="list-group position-absolute w-100"
                    style="top: 100%; z-index: 1000;" role="listbox" aria-label="Suggestions dâ€™utilisateurs Ã  bloquer"></ul>
            </form>
        </div>
    </section>

    <!-- ðŸ”¹ Liste des utilisateurs bloquÃ©s -->
    <section class="card shadow-sm mb-5" aria-labelledby="blocked-title">
        <div class="card-body">
            <h2 id="blocked-title" class="card-title mb-3 fs-4">â›” Utilisateurs bloquÃ©s</h2>
            <ul class="list-group" role="list" aria-label="Liste des utilisateurs bloquÃ©s">
                {% for blocked in blocked_list %}
                    <li class="list-group-item d-flex justify-content-between align-items-center" role="listitem">
                        <span>{{ blocked.blocked_user.username }}</span>
                        <a href="{% url 'unblock_user' blocked.blocked_user.id %}" 
                           class="btn btn-success btn-sm" aria-label="DÃ©bloquer {{ blocked.blocked_user.username }}">
                            <i class="bi bi-unlock" aria-hidden="true"></i> DÃ©bloquer
                        </a>
                    </li>
                {% empty %}
                    <li class="list-group-item text-muted text-center">Aucun utilisateur bloquÃ©.</li>
                {% endfor %}
            </ul>
        </div>
    </section>

</div>
{% endblock %}
